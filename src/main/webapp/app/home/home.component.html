<!-- home.component.html -->
<div class="row">
  <div class="col-12">
    <h1 class="display-4 mb-4">Fleet Management Dashboard</h1>

    @if (account() !== null) {
      <div class="alert alert-success mb-4">
        @if (account(); as accountRef) {
          <span
            >Welcome back, <strong>{{ accountRef.login }}</strong></span
          >
        }
      </div>

      <!-- Quick Stats Row -->
      <div class="row mb-4">
        <!-- Vehicle Status -->
        <div class="col-md-3">
          <div class="card border-primary">
            <div class="card-body">
              <h5 class="card-title text-primary"><i class="fa fa-truck"></i> Fleet Status</h5>
              <h2 class="mb-3">{{ vehicleStats().total }}</h2>
              <div class="small">
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-success">In Trip:</span>
                  <strong>{{ vehicleStats().inTrip }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-info">Available:</span>
                  <strong>{{ vehicleStats().available }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-warning">Maintenance:</span>
                  <strong>{{ vehicleStats().maintenance }}</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-muted">Idle:</span>
                  <strong>{{ vehicleStats().idle }}</strong>
                </div>
              </div>
              <a routerLink="/vehicle" class="btn btn-sm btn-outline-primary mt-3 w-100">View Fleet</a>
            </div>
          </div>
        </div>

        <!-- Incidents -->
        <div class="col-md-3">
          <div class="card border-danger">
            <div class="card-body">
              <h5 class="card-title text-danger"><i class="fa fa-exclamation-triangle"></i> Incidents</h5>
              <h2 class="mb-3">{{ incidentStats().thisMonth }}</h2>
              <div class="small">
                <div class="d-flex justify-content-between mb-1">
                  <span>Accidents:</span>
                  <strong>{{ incidentStats().accidents }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                  <span>Breakdowns:</span>
                  <strong>{{ incidentStats().breakdowns }}</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span>Dents:</span>
                  <strong>{{ incidentStats().dents }}</strong>
                </div>
              </div>
              <a routerLink="/incident-log" class="btn btn-sm btn-outline-danger mt-3 w-100">View Incidents</a>
            </div>
          </div>
        </div>

        <!-- Outstanding Invoices -->
        <div class="col-md-3">
          <div class="card border-warning">
            <div class="card-body">
              <h5 class="card-title text-warning"><i class="fa fa-file-invoice-dollar"></i> Invoices</h5>
              <h2 class="mb-3">{{ invoiceStats().outstanding }}</h2>
              <div class="small">
                <div class="d-flex justify-content-between mb-1">
                  <span class="text-danger">Overdue:</span>
                  <strong>{{ invoiceStats().overdue }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>Outstanding:</span>
                  <strong>${{ invoiceStats().totalAmount | number: '1.0-0' }}</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-danger">Overdue Amount:</span>
                  <strong>${{ invoiceStats().overdueAmount | number: '1.0-0' }}</strong>
                </div>
              </div>
              <a routerLink="/invoice" class="btn btn-sm btn-outline-warning mt-3 w-100">View Invoices</a>
            </div>
          </div>
        </div>

        <!-- Active Trips -->
        <div class="col-md-3">
          <div class="card border-success">
            <div class="card-body">
              <h5 class="card-title text-success"><i class="fa fa-route"></i> Trips</h5>
              <h2 class="mb-3">{{ tripStats().activeTrips }}</h2>
              <div class="small">
                <div class="d-flex justify-content-between mb-1">
                  <span>Active Now:</span>
                  <strong>{{ tripStats().activeTrips }}</strong>
                </div>
                <div class="d-flex justify-content-between mb-1">
                  <span>Completed Today:</span>
                  <strong>{{ tripStats().completedToday }}</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span>Scheduled Tomorrow:</span>
                  <strong>{{ tripStats().scheduledTomorrow }}</strong>
                </div>
              </div>
              <a routerLink="/fleet-trip" class="btn btn-sm btn-outline-success mt-3 w-100">View Trips</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Financial Overview -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title"><i class="fa fa-chart-line"></i> Monthly Financial Overview</h5>
              <div class="row text-center mt-3">
                <div class="col-md-4">
                  <h6 class="text-muted">Revenue</h6>
                  <h3 class="text-success">${{ financialStats().monthlyRevenue | number: '1.0-0' }}</h3>
                </div>
                <div class="col-md-4">
                  <h6 class="text-muted">Expenses</h6>
                  <h3 class="text-danger">${{ financialStats().monthlyExpenses | number: '1.0-0' }}</h3>
                </div>
                <div class="col-md-4">
                  <h6 class="text-muted">Net Profit</h6>
                  <h3 class="text-primary">${{ financialStats().netProfit | number: '1.0-0' }}</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Alerts -->
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title"><i class="fa fa-bell"></i> Recent Alerts</h5>
              @if (recentAlerts().length > 0) {
                <ul class="list-group list-group-flush">
                  @for (alert of recentAlerts(); track alert) {
                    <li class="list-group-item">
                      <i class="fa fa-{{ alert.icon }} text-{{ alert.type }}"></i>
                      <span class="ms-2">{{ alert.message }}</span>
                    </li>
                  }
                </ul>
              } @else {
                <p class="text-muted">No alerts at this time.</p>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="row mt-4">
        <div class="col-md-12">
          <h5>Quick Actions</h5>
          <div class="btn-group" role="group">
            <a routerLink="/fleet-trip/new" class="btn btn-primary"> <i class="fa fa-plus"></i> New Trip </a>
            <a routerLink="/invoice/new" class="btn btn-success"> <i class="fa fa-file-invoice"></i> New Invoice </a>
            <a routerLink="/fuel-log/new" class="btn btn-info"> <i class="fa fa-gas-pump"></i> Log Fuel </a>
            <a routerLink="/service-log/new" class="btn btn-warning"> <i class="fa fa-wrench"></i> Log Service </a>
          </div>
        </div>
      </div>
    } @else {
      <!-- Not logged in -->
      <div class="alert alert-warning">
        <span>Please <a class="alert-link" (click)="login()">sign in</a> to access the dashboard.</span>
      </div>
    }
  </div>
</div>
